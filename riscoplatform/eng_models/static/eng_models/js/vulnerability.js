 "use strict";

(function($) {
$( document ).ready(function() {

var categories;
var values;
var error;

var url = document.URL.split('/');
var model_id = url[url.length -2];

var get_taxonomy = function(tax){

    $.ajax(BASE_URL+'/models/vulnerability/'+model_id+'/taxonomy/'+tax )
    .done(function(data) {

        categories = data.iml;
        values = data.function;
        error = data.error;

        update_vulnerability();
    });

}

$('#select').on('change', function() {
get_taxonomy($(this).val());
});


get_taxonomy($('#select').val())


var update_vulnerability = function(){

        var chart = new Highcharts.Chart({
            chart: {
                renderTo: 'chart-container',
            },
            title: {
                text: 'Vulnerability Function'
            },
            subtitle: {
                text: ''
            },
            xAxis: {
                categories: categories,
                title: {
                    text: null
                }
            },
            yAxis: {
                min: 0,
                //max: 1.0,
                title: {
                    text: 'Loss ratio',
                },
                labels: {
                    overflow: 'justify'
                }
            },
            tooltip: {
                valueSuffix: ''
            },
            plotOptions: {
                bar: {
                    dataLabels: {
                        enabled: true
                    }
                }
            },
            credits: {
                enabled: false
            },
            series: [{
                id: 'cons',
                name: 'Loss ratio',
                data: values
            }, { 
                name: 'Variation',
                type: 'errorbar',
                data: error
            }
            ]
        });
    }



});
})($); 