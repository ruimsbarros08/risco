{% extends "base.html" %}

{% block content %}
{% load staticfiles%}
{% load humanize %}
{% load avatar_tags %}

<div ng-app="exposureIndexApp" ng-controller="exposureIndexCtrl">

	<div class="container-fluid" >

		<div class="row">
			<div class="col-md-12">
				<ul class="breadcrumb">
				  	<li><a href="{% url 'eng_models_home' %}">Models</a></li>
				  	<li class="active">Exposure</li>
				</ul>
			</div>
		</div>


		<div class="row" style="height:90vh;">
			<div class="col-md-2">

				<div class="row">
				<a href="#addModel" du-smooth-scroll duration="5000">
					<div class="col-md-12 btn btn-success">
						Create Model <span class="glyphicon glyphicon-globe" aria-hidden="true"></span>
					</div>
				</a>
				</div>
				<br>


				{% if models %}

				<div class="row" style="height:80vh; overflow-y: auto;">

					{% for model in models %}
					<div class="col-md-12">
						<div class="well">
							<div class="row">
								<div class="col-md-8">
									<h4><a href="{% url 'detail_exposure' model.id %}">{{ model.name }}</a></h4>
									<p>{{ model.description }}</p>
									<p>Taxonomy source: <a href="{% url 'detail_taxonomy' model.taxonomy_source.id %}">{{ model.taxonomy_source }}</a></p>
									<p>Authors:
									{% for contributor in model.exposure_model_contributor_set.all %}
										{% if contributor.author %}
											<a href="#" > {% avatar contributor.contributor 30 %} {{ contributor.contributor.first_name }} {{ contributor.contributor.last_name }}</a>
											{% if model.exposure_model_contributor_set.all|length > 1 %}
												{% if not forloop.last %},{% else %} and {% endif %}
											{% endif %}
										{% endif %}
									{% endfor %}
									</p>
									<p>Contributors:
									{% for contributor in model.exposure_model_contributor_set.all %}
										{% if not contributor.author %}
											<a href="#">{{ contributor.contributor.first_name }} {{ contributor.contributor.last_name }}</a>
											{% if model.exposure_model_contributor_set.all|length > 1 %}
												{% if not forloop.last %},{% else %} and {% endif %}
											{% endif %}
										{% endif %}
									{% endfor %}
									</p>
								</div>
								<div class="col-md-4">
									{{ model.date_created|naturalday }}
								</div>
							</div>
						</div>
					</div>
					{% endfor %}


				</div>

				{% else %}
					<br>
					<div class="row">
						<div class="col-md-12">
							<div class="alert alert-dismissable alert-info">
							<button type="button" class="close" data-dismiss="alert">Ã—</button>
						    	<p>No models are available. Please add the first</p>
						    </div>
						</div>
					</div>
				{% endif %}
			</div>
			<div class="col-md-10">
				<div id="map" style="height:90vh;"></div>
			</div>
		</div>
	</div>

	<br>

	<div id='addModel' class="container">
		<div class="row">
	        <div style="height:100px;"></div>
	    </div>

		<div class="row">
			<div class="col-md-8 col-md-offset-2">
				<form action="{% url 'add_exposure_model' %}" method="post" enctype="multipart/form-data" class="form-horizontal">
					<fieldset>
						<legend>Insert new model</legend>

						{% csrf_token %}

						{% for field in form %}
					  		{% if field.name in categories.general %}

					  			{% include 'form_field.html' %}

							{% endif %}
					    {% endfor %}

						<ul class="nav nav-tabs">
						  	<li class="active"><a href="#area" data-toggle="tab" aria-expanded="true">Area</a></li>
						  	<li class=""><a href="#structural" data-toggle="tab" aria-expanded="true">Structural</a></li>
						  	<li class=""><a href="#nonstructural" data-toggle="tab" aria-expanded="true">Nonstructural</a></li>
						  	<li class=""><a href="#contents" data-toggle="tab" aria-expanded="true">Contents</a></li>
						  	<li class=""><a href="#business_int" data-toggle="tab" aria-expanded="true">Business interruption</a></li>
						</ul>
						<div id="myTabContent" class="tab-content">
						  <div class="tab-pane fade active in" id="area">

						  	{% for field in form %}
						  		{% if field.name in categories.area %}

						  			{% include 'form_field.html' %}

								{% endif %}
						    {% endfor %}

						  </div>

						  <div class="tab-pane fade" id="structural">

						  	{% for field in form %}
						  		{% if field.name in categories.structural %}

						  			{% include 'form_field.html' %}

								{% endif %}
						    {% endfor %}

						  </div>


						  <div class="tab-pane fade" id="nonstructural">

						  	{% for field in form %}
						  		{% if field.name in categories.nonstructural %}
								    
						  			{% include 'form_field.html' %}

								{% endif %}
						    {% endfor %}

						  </div>

						  <div class="tab-pane fade" id="contents">

						  	{% for field in form %}
						  		{% if field.name in categories.contents %}
								    
						  			{% include 'form_field.html' %}

								{% endif %}
						    {% endfor %}

						  </div>

						  <div class="tab-pane fade" id="business_int">

						  	{% for field in form %}
						  		{% if field.name in categories.business_int %}
								    
						  			{% include 'form_field.html' %}

								{% endif %}
						    {% endfor %}

						  </div>

						</div>
						<div class="form-group">
						    <div class="col-lg-5 col-lg-offset-2">
						        <input class="btn btn-primary" type="submit" value="Create model" />
						    </div>
						</div>
					</fieldset>
				</form>
			</div>
		</div>

		{% if parse_error %}
		<br>
		<div class="row">
			<div class="col-md-8 col-md-offset-2">
				<div class="alert alert-dismissible alert-danger">
				  	<p>Error: Your file is not a valid xml input file for Openquake</p>
				  	<p>{{ parse_error }}</p>
				</div>
			</div>
		</div>
		{% endif %}
	</div>
</div>

{% load staticfiles %}
<script type="text/javascript" src="{% static 'eng_models/js/exposureIndex.js' %}"></script>

{% endblock %}
