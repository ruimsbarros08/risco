{% extends "base.html" %}

{% block content %}

<div class="container-fluid" ng-app="riskResultsApp" ng-controller="riskResultsCtrl">

<div class="row">
	<div class="col-md-6">
		<ul class="breadcrumb">
		  	<li> <a href="{% url 'jobs_home' %}">Jobs</a></li>
		  	<li> <a href="{% url 'index_event_based_risk' %}">Event Based PSHA Risk</a></li>
		  	<li class="active">{{ job.name }}</li>
		</ul>
	</div>
</div>

	<div class="row">
		<div class="col-md-12">
			<h3> {{ job.name }} </h3><br>
			<h4> {{ job.description }} </h4><br>
		</div>
	</div>

	<div class="row">
		
		<div class="col-md-10">
			<div id='map' style="height:700px;"></div><br>

			<div id="region-selector" style="width:100px;">
				<select ng-model="region0" ng-options="region.name for region in regions0" class="form-control input-sm" ng-change='selectRegion(1, region0.id)'>
					<option style="display:none" value="">Country</option>
				</select>
                
                <select ng-model="region1" ng-options="region.name for region in regions1" class="form-control input-sm" ng-change='selectRegion(2, region1.id)' ng-disabled='region1Disabled'>
                	<option style="display:none" value="">Level 1</option>
                </select>
                
                <select ng-model="region2" ng-options="region.name for region in regions2" class="form-control input-sm" ng-change='selectRegion(3, region2.id)' ng-disabled='region2Disabled'>
                	<option style="display:none" value="">Level 2</option>
                </select>
            	
            	<button class="btn btn-sm" ng-click='goHome()' ng-disabled='disableHome'><span class="glyphicon glyphicon-home" aria-hidden="true"></span></button>
            	
            	<button class="btn btn-sm" ng-click='upOneLevel()' ng-disabled='disableUp'><span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span></button>
            </div>

			<div id="taxonomy-selector" style="display: inline; width:100px;">
				<select style="width:100%;" ng-model='taxonomy' ng-options="taxonomy.name for taxonomy in taxonomies" class="form-control input-sm" ng-change='setTaxonomy(taxonomy.id)'>
					<option style="display:none" value="">Taxonomy</option>
				</select>
                
                <button class="btn btn-sm" ng-click='allTaxonomies()' ng-disabled='disableAllTaxonomies'>All</button>
            </div>

			<div id="poe-selector" style="width:100px;">
				<select style="width:100%;" ng-model='poe' ng-options="poe for poe in poes" class="form-control input-sm" ng-change='setPoe(poe)'>
					<option style="display:none" value="">Poe</option>
				</select>
            </div>

			<div id="quantile-selector" style="width:100px;">
				<select style="width:100%;" ng-model='statistics' ng-options="quantile for quantile in quantiles" class="form-control input-sm" ng-change='setQuantile(statistics)'>
					<option style="display:none" value="">Statistics</option>
				</select>
            </div>

			<div id="vulnerability-selector" style="width:100px;">
				<select style="width:100%;" ng-model='vulnerability' ng-options="vulnerability for vulnerability in vulnerabilities" class="form-control input-sm" ng-change='setVulnerability(vulnerability)'>
					<option style="display:none" value="">Loss type</option>
				</select>
            </div>
            <div id="charts" style="background-color: rgba(255, 255, 255, 0.5);">
				<canvas id="regions_chart" class="chart chart-doughnut" data="region_data" labels="region_labels" legend="true"></canvas>
				<canvas id="taxonomies_chart" class="chart chart-doughnut" data="taxonomies_data" labels="taxonomies_labels" legend="true" ng-show="disableAllTaxonomies"></canvas>
            </div>

		</div>

		<div class="col-md-2">

			{% if job.status == 'CREATED' %}
			<div class="row">
				<div class="col-md-12">
					<a href="{% url 'start_event_based_risk' job.id %}"> <button class="btn btn-danger" style="width:100%;">Start job <span class="glyphicon glyphicon-play" aria-hidden="true"></span> </button></a>
				</div>
			</div>
			<br>
			{% elif job.status == 'STARTED' %}
			<div class="row">
				<div class="col-md-12">
					<button class="btn btn-warning disabled" style="width:100%;">Calculating...</button>
				</div>
			</div>
			<br>
			{% elif job.status == 'ERROR' %}
			<div class="row">
				<div class="col-md-12">
					<button class="btn btn-danger disabled" style="width:100%;">ERROR!</button>
				</div>
			</div>
			<br>
			{% elif job.status == 'FINISHED' %}
			<div class="row">
				<div class="col-md-12">
					<button class="btn btn-success disabled" style="width:100%;">Results ready!</button>
				</div>
			</div>
			<br>
			{% endif %}

			{% if connection_error %}
			<div class="row">
				<div class="col-md-12">
					<button class="btn btn-error" style="width:100%;">Impossible to lauch the job. Please try again later</button>
				</div>
			</div>
			{% endif %}

			<div class="row">
				<div class="col-md-12">
					<button class="btn btn-primary" style="width:100%;">Download files <span class="glyphicon glyphicon-download" aria-hidden="true"></span> </button>
				</div>
			</div>
			<br>

			<div class="row">
				<div class="col-md-12">

					<ul class="list-group">
					  	<li class="list-group-item active">
					  	Job parameters	
					  	</li>


						<li class="list-group-item">
						<b>Random seed:</b> {{ job.random_seed }}
					  	</li>


						<li class="list-group-item">
						<b>Hazard:</b> <a href="{% url 'results_event_based_hazard' job.hazard_event_based.id %}">{{ job.hazard }}</a>
					  	</li>

						<li class="list-group-item">
						<b>Exposure model:</b> <a href="{% url 'detail_exposure' job.exposure_model.id %}">{{ job.exposure_model }}</a>
					  	</li>


					  	<li class="list-group-item">
						<b>Asset hazard distance:</b> {{ job.asset_hazard_distance }}
					  	</li>

					  	<li class="list-group-item">
						<b>lrem steps per interval:</b> {{ job.lrem_steps_per_interval }}
					  	</li>

					</ul>
				</div>
			</div>
		</div>
	</div>


	{% if job.status == 'FINISHED' %}
	<div class="row">
<!-- 		<div class="col-md-3">
			<canvas id="regions_chart" class="chart chart-doughnut" data="region_data" labels="region_labels" legend="true"></canvas>
		</div>
		<div class="col-md-3">
			<canvas id="taxonomies_chart" class="chart chart-doughnut" data="taxonomies_data" labels="taxonomies_labels" legend="true"></canvas>
		</div> -->


	</div>
	{% endif %}


</div>

{% load staticfiles %}
<script type="text/javascript" src="{% static 'jobs/js/psha_risk_results.js' %}"></script>

{% endblock %}